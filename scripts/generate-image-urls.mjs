import { readdir, writeFile } from 'node:fs/promises';
import path from 'node:path';

const repoRoot = process.cwd();
const imagesDir = path.join(repoRoot, 'public', 'images');
const outFile = path.join(repoRoot, 'src', 'generated', 'imageUrls.ts');

function isWebp(filename) {
  return filename.toLowerCase().endsWith('.webp');
}

function toPublicUrl(filename) {
  return `/images/${filename}`;
}

async function main() {
  let entries = [];
  try {
    entries = await readdir(imagesDir, { withFileTypes: true });
  } catch {
    entries = [];
  }

  const files = entries
    .filter((e) => e.isFile())
    .map((e) => e.name)
    .filter((name) => name !== '.gitkeep')
    .filter(isWebp)
    .sort((a, b) => a.localeCompare(b, 'en'))
    .map(toPublicUrl);

  const content = `// This file is auto-generated by scripts/generate-image-urls.mjs
// Do not edit manually.

export const DEFAULT_IMAGE_URLS: string[] = ${JSON.stringify(files, null, 2)};
`;

  await writeFile(outFile, content, 'utf8');
  console.log(`Generated ${files.length} image URL(s) -> ${path.relative(repoRoot, outFile)}`);
}

await main();
